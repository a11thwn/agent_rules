# Code Review Skill

## 触发条件
当用户要求审查代码、检查 PR、或验证实现质量时使用此技能。

## 执行步骤

### 1. 收集上下文
- 读取需要审查的文件
- 理解代码的目的和业务逻辑
- 查找相关的测试文件
- 检查依赖的模块和服务

### 2. 检查项清单

#### 代码质量
- [ ] 逻辑是否正确，是否有边界情况未处理
- [ ] 是否有明显的性能问题（如 O(n²) 复杂度）
- [ ] 错误处理是否完善，是否捕获了必要的异常
- [ ] 是否有安全隐患（注入攻击、数据暴露等）

#### 代码规范
- [ ] 是否符合项目的代码风格（使用 lsp_diagnostics 检查）
- [ ] 变量和函数命名是否清晰、一致
- [ ] 注释是否充分且准确
- [ ] 是否有冗余代码或可以简化的部分

#### 架构设计
- [ ] 代码结构是否合理，职责是否清晰
- [ ] 是否违反了项目的架构约束（如 service 层调用外部依赖）
- [ ] 是否遵循了现有的设计模式
- [ ] 是否有循环依赖或紧耦合

#### 测试覆盖
- [ ] 是否有足够的单元测试
- [ ] 测试用例是否覆盖了关键路径
- [ ] 边界条件和异常情况是否有测试

### 3. 优先级分类

**高优先级（必须修复）**：
- 逻辑错误和 Bug
- 安全漏洞
- 性能严重问题
- 破坏性操作（如数据丢失风险）

**中优先级（建议修复）**：
- 代码规范问题
- 可维护性问题
- 测试覆盖不足

**低优先级（可选优化）**：
- 命名建议
- 代码风格细微调整
- 性能轻微优化

### 4. 输出格式

```
## 代码审查报告

### 文件：`path/to/file.ts`

#### 高优先级问题
1. **问题类型**: Bug / 安全 / 性能
   - 位置：第 X 行
   - 描述：[具体问题描述]
   - 影响：[说明可能导致的后果]
   - 建议：[修复建议]

#### 中优先级问题
1. **问题类型**: 代码规范 / 可维护性
   - 位置：第 X 行
   - 描述：[具体问题描述]
   - 建议：[改进建议]

#### 低优先级建议
1. **问题类型**: 命名 / 风格
   - 位置：第 X 行
   - 建议：[优化建议]

### 总体评价
[整体评价：优秀 / 良好 / 需要改进]
```

### 5. 验证工具
- 使用 `lsp_diagnostics` 检查语法和类型错误
- 运行 `bash` 执行测试套件
- 使用 `grep` 搜索潜在的坏味道模式

## 注意事项
- 只审查用户指定的代码，不要审查未修改的代码
- 确保意见具体可操作，避免模糊的建议
- 对不确定的问题，标记为"需要进一步确认"
- 保持客观、建设性的语气
